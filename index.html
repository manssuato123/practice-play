<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Practice Play</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b0f1a">

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#0b0f1a;color:#fff;margin:0;padding:20px}
.wrap{max-width:900px;margin:auto}
.card{background:#141827;border:1px solid #2a2f45;border-radius:12px;padding:15px;margin-bottom:15px}
textarea{width:100%;height:180px;background:#0d1020;color:#fff;border:1px solid #2a2f45;border-radius:10px;padding:10px}
button{background:#d4af37;color:#111;border:none;border-radius:10px;padding:10px 15px;font-weight:bold;cursor:pointer}
.dark{background:#2c3350;color:#fff}
.big{font-size:22px;font-weight:bold;margin-top:10px}
.pill{display:inline-block;background:#1b223a;padding:6px 12px;border-radius:999px;font-size:13px}
</style>
</head>

<body>
<div class="wrap">
<h2>Practice Play</h2>

<div class="card">
<textarea id="phrases">
I think so. | Eu acho que sim.
I don’t think so. | Eu não acho que sim.
It depends. | Depende.
That makes sense. | Isso faz sentido.
I’m not sure. | Não tenho certeza.
</textarea>
<br><br>
<button onclick="start()">▶ Play</button>
<button class="dark" onclick="stop()">⏹ Stop</button>
</div>

<div class="card">
<div class="pill">Frase: <span id="counter">0</span></div>
<div class="big" id="en">—</div>
<div id="pt" style="margin-top:10px;color:#a9b2d6"></div>
</div>
</div>

<script>
let list=[];
let i=0;
let running=false;

function parse(){
  list = document.getElementById("phrases").value
    .split("\n")
    .map(l=>l.trim())
    .filter(l=>l.includes("|"))
    .map(l=>{
      let p=l.split("|");
      return {en:p[0].trim(),pt:p[1].trim()};
    });
}

function speak(text,lang){
  return new Promise(r=>{
    let u=new SpeechSynthesisUtterance(text);
    u.lang=lang;
    u.rate=1;
    u.onend=r;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  });
}

async function playOne(){
  if(!running || i>=list.length) return;

  let item=list[i];
  document.getElementById("en").innerText=item.en;
  document.getElementById("pt").innerText=item.pt;
  document.getElementById("counter").innerText=(i+1)+"/"+list.length;

  // inglês 3x
  for(let x=0;x<3;x++){
    if(!running) return;
    await speak(item.en,"en-GB");
  }

  // português 1x
  await speak(item.pt,"pt-BR");

  i++;
  setTimeout(playOne,500);
}

function start(){
  parse();
  i=0;
  running=true;
  playOne();
}

function stop(){
  running=false;
  speechSynthesis.cancel();
}
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
